-- ZenRed Fixed UI Script
-- Fully self-contained, no external libraries
-- Movable, closable, minimizable, Zen Red theme

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- THEME
local Theme = {
    TextColor = Color3.fromRGB(245,245,245),
    Background = Color3.fromRGB(200,80,100),
    Topbar = Color3.fromRGB(180,60,90),
    Shadow = Color3.fromRGB(20,20,20),
    TabBackground = Color3.fromRGB(150,50,70),
    TabBackgroundSelected = Color3.fromRGB(230,100,120),
    ElementBackground = Color3.fromRGB(170,60,80),
    ElementBackgroundHover = Color3.fromRGB(190,80,100),
    Accent = Color3.fromRGB(245,120,140),
    NotificationBackground = Color3.fromRGB(160,50,70)
}

local DECAL_ID = 89244296158758
local WINDOW_TITLE = "ZenRed UI"
local TOGGLE_KEY = Enum.KeyCode.K

local function new(class, props)
    local obj = Instance.new(class)
    if props then
        for k,v in pairs(props) do pcall(function() obj[k]=v end) end
    end
    return obj
end

-- DRAGGING
local function makeDraggable(gui)
    local dragging, dragInput, dragStart, startPos
    local cam = workspace.CurrentCamera
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = gui.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging=false end
            end)
        end
    end)
    gui.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            local view = cam.ViewportSize
            gui.Position = UDim2.new(
                math.clamp(startPos.X.Scale + delta.X/view.X,0,1-gui.Size.X.Scale),
                startPos.X.Offset + delta.X,
                math.clamp(startPos.Y.Scale + delta.Y/view.Y,0,1-gui.Size.Y.Scale),
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- MAIN UI CREATION
local pg = LocalPlayer:WaitForChild("PlayerGui")
local root = new("ScreenGui",{Name="ZenRedUI",Parent=pg,ResetOnSpawn=false})

-- Shadow
local shadow = new("Frame",{Parent=root,Size=UDim2.new(0,520,0,360),Position=UDim2.new(0.5,-260,0.5,-180),BackgroundColor3=Theme.Shadow,BorderSizePixel=0})
shadow.AnchorPoint = Vector2.new(0,0)

-- Main window
local window = new("Frame",{Parent=root,Size=UDim2.new(0,520,0,360),Position=shadow.Position,BackgroundColor3=Theme.Background,BorderSizePixel=0})
window.AnchorPoint = Vector2.new(0,0)

-- Topbar
local topbar = new("Frame",{Parent=window,Size=UDim2.new(1,0,0,36),BackgroundColor3=Theme.Topbar,BorderSizePixel=0})
local icon = new("ImageLabel",{Parent=topbar,Size=UDim2.new(0,32,0,32),Position=UDim2.new(0,6,0,2),BackgroundTransparency=1,Image="rbxassetid://"..DECAL_ID})
local title = new("TextLabel",{Parent=topbar,Size=UDim2.new(1,-140,1,0),Position=UDim2.new(0,46,0,0),Text=WINDOW_TITLE,TextColor3=Theme.TextColor,Font=Enum.Font.SourceSansBold,TextSize=18,BackgroundTransparency=1,TextXAlignment=Enum.TextXAlignment.Left})

-- Minimize / Close
local minBtn = new("TextButton",{Parent=topbar,Size=UDim2.new(0,26,0,26),Position=UDim2.new(1,-70,0,5),Text="-",Font=Enum.Font.SourceSansBold,TextSize=20,TextColor3=Theme.TextColor,BackgroundColor3=Theme.TabBackgroundSelected})
local closeBtn = new("TextButton",{Parent=topbar,Size=UDim2.new(0,26,0,26),Position=UDim2.new(1,-34,0,5),Text="X",Font=Enum.Font.SourceSansBold,TextSize=16,TextColor3=Theme.TextColor,BackgroundColor3=Theme.TabBackgroundSelected})

-- Panels
local tabsPanel = new("Frame",{Parent=window,Size=UDim2.new(0,140,1,-36),Position=UDim2.new(0,0,0,36),BackgroundTransparency=1})
local contentPanel = new("Frame",{Parent=window,Size=UDim2.new(1,-140,1,-36),Position=UDim2.new(0,140,0,36),BackgroundTransparency=1})

makeDraggable(topbar)
makeDraggable(window)

-- Mini icon
local miniSG = new("ScreenGui",{Parent=pg,ResetOnSpawn=false})
local miniIcon = new("ImageButton",{Parent=miniSG,Size=UDim2.new(0,48,0,48),Position=UDim2.new(0,10,0,10),BackgroundColor3=Theme.Topbar,Image="rbxassetid://"..DECAL_ID,AutoButtonColor=true})
miniSG.Enabled=false

local function minimize() root.Enabled=false; miniSG.Enabled=true end
local function restore() root.Enabled=true; miniSG.Enabled=false end
minBtn.MouseButton1Click:Connect(minimize)
miniIcon.MouseButton1Click:Connect(restore)
closeBtn.MouseButton1Click:Connect(function() root:Destroy(); miniSG:Destroy() end)
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode==TOGGLE_KEY then
        if root.Enabled then minimize() elseif miniSG.Enabled then restore() else root.Enabled=true end
    end
end)

-- TAB SYSTEM
local tabs = {}
local function CreateTab(tabName)
    local idx = #tabs+1
    local btn = new("TextButton",{Parent=tabsPanel,Size=UDim2.new(1,-12,0,40),Position=UDim2.new(0,6,0,(idx-1)*44+6),Text=tabName,Font=Enum.Font.SourceSans,TextSize=16,TextColor3=Theme.TextColor,BackgroundColor3=Theme.TabBackground})
    local page = new("Frame",{Parent=contentPanel,Size=UDim2.new(1,-12,1,-12),Position=UDim2.new(0,6,0,6),BackgroundTransparency=1,Visible=false})
    local tabObj = {Button=btn,Page=page}
    btn.MouseButton1Click:Connect(function()
        for _,t in pairs(tabs) do t.Page.Visible=false; t.Button.BackgroundColor3=Theme.TabBackground end
        page.Visible=true
        btn.BackgroundColor3=Theme.TabBackgroundSelected
    end)
    table.insert(tabs,tabObj)
    if #tabs==1 then btn.MouseButton1Click() end
    return page
end

local function nextY(parent)
    local y=6
    for _,c in pairs(parent:GetChildren()) do if c:IsA("GuiObject") and c.Visible then y=y+c.Size.Y.Offset+8 end end
    return y
end

local function CreateLabel(page,text)
    return new("TextLabel",{Parent=page,Size=UDim2.new(1,-12,0,22),Position=UDim2.new(0,6,0,nextY(page)),BackgroundTransparency=1,Text=text or "",TextColor3=Theme.TextColor,Font=Enum.Font.SourceSans,TextSize=16,TextXAlignment=Enum.TextXAlignment.Left})
end

local function CreateButton(page,text,cb)
    local btn = new("TextButton",{Parent=page,Size=UDim2.new(1,-12,0,30),Position=UDim2.new(0,6,0,nextY(page)),Text=text or "Button",TextColor3=Theme.TextColor,BackgroundColor3=Theme.ElementBackground,Font=Enum.Font.SourceSans,TextSize=16})
    btn.MouseButton1Click:Connect(function() pcall(cb) end)
    return btn
end

local function CreateToggle(page,text,default,cb)
    local container = new("Frame",{Parent=page,Size=UDim2.new(1,-12,0,28),Position=UDim2.new(0,6,0,nextY(page)),BackgroundTransparency=1})
    local lbl = new("TextLabel",{Parent=container,Size=UDim2.new(1,-60,1,0),Position=UDim2.new(0,0,0,0),Text=text or "Toggle",TextColor3=Theme.TextColor,Font=Enum.Font.SourceSans,TextSize=16,BackgroundTransparency=1,TextXAlignment=Enum.TextXAlignment.Left})
    local btn = new("TextButton",{Parent=container,Size=UDim2.new(0,46,0,20),Position=UDim2.new(1,-50,0,4),Text="",AutoButtonColor=false,BackgroundColor3=default and Theme.Accent or Color3.fromRGB(100,100,100)})
    local state=not not default
    btn.MouseButton1Click:Connect(function()
        state=not state
        btn.BackgroundColor3=state and Theme.Accent or Color3.fromRGB(100,100,100)
        if cb then pcall(cb,state) end
    end)
    return {Get=function() return state end,Set=function(v) state=not not v; btn.BackgroundColor3=state and Theme.Accent or Color3.fromRGB(100,100,100) end,UI=container}
end

-- CREATE SAMPLE UI
local homePage = CreateTab("Home")
CreateLabel(homePage,"Menus Section")
CreateButton(homePage,"Sample Button",function() print("Button pressed!") end)
CreateToggle(homePage,"Sample Toggle",true,function(v) print("Toggle: "..tostring(v)) end)

local settingsPage = CreateTab("Settings")
CreateLabel(settingsPage,"Settings Section")
CreateButton(settingsPage,"Another Button",function() print("Settings button clicked!") end)
CreateToggle(settingsPage,"Another Toggle",false,function(v) print("Settings toggle: "..tostring(v)) end)

print("ZenRed UI loaded! Press K to toggle/minimize")
